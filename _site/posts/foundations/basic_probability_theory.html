<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2022-07-26">
<meta name="description" content="Basics">

<title>Learn statistics with AI - Basic Probability theory</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Learn statistics with AI</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Summary</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#concepts" id="toc-concepts" class="nav-link" data-scroll-target="#concepts">Concepts</a>
  <ul class="collapse">
  <li><a href="#probability" id="toc-probability" class="nav-link" data-scroll-target="#probability">1. <strong>Probability</strong>:</a></li>
  <li><a href="#sample-space-s" id="toc-sample-space-s" class="nav-link" data-scroll-target="#sample-space-s">2. <strong>Sample Space (S)</strong>:</a></li>
  <li><a href="#event-e" id="toc-event-e" class="nav-link" data-scroll-target="#event-e">3. <strong>Event (E)</strong>:</a></li>
  <li><a href="#probability-of-an-event" id="toc-probability-of-an-event" class="nav-link" data-scroll-target="#probability-of-an-event">4. <strong>Probability of an Event</strong>:</a></li>
  <li><a href="#complementary-events" id="toc-complementary-events" class="nav-link" data-scroll-target="#complementary-events">5. <strong>Complementary Events</strong>:</a></li>
  <li><a href="#independent-events" id="toc-independent-events" class="nav-link" data-scroll-target="#independent-events">6. <strong>Independent Events</strong>:</a></li>
  <li><a href="#conditional-probability" id="toc-conditional-probability" class="nav-link" data-scroll-target="#conditional-probability">7. <strong>Conditional Probability</strong>:</a></li>
  <li><a href="#bayes-theorem" id="toc-bayes-theorem" class="nav-link" data-scroll-target="#bayes-theorem">8. <strong>Bayes’ theorem</strong>:</a></li>
  </ul></li>
  <li><a href="#why-are-these-concepts-important-in-the-real-world" id="toc-why-are-these-concepts-important-in-the-real-world" class="nav-link" data-scroll-target="#why-are-these-concepts-important-in-the-real-world">Why Are These Concepts Important in the Real World?</a></li>
  <li><a href="#recommended-books" id="toc-recommended-books" class="nav-link" data-scroll-target="#recommended-books">Recommended books</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Basic Probability theory</h1>
  <div class="quarto-categories">
    <div class="quarto-category">probability</div>
  </div>
  </div>

<div>
  <div class="description">
    Basics
  </div>
</div>


<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 26, 2022</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Probability theory is the branch of mathematics concerned with analyzing random phenomena. It deals with calculating the likelihood of events occurring.</p>
</section>
<section id="concepts" class="level2">
<h2 class="anchored" data-anchor-id="concepts">Concepts</h2>
<p>Key concepts include sample spaces, events, probability axioms, conditional probability, independence, and Bayes’ theorem.</p>
<section id="probability" class="level3">
<h3 class="anchored" data-anchor-id="probability">1. <strong>Probability</strong>:</h3>
<p><strong>Probability</strong> measures the likelihood that a specific event will occur. It is a number between 0 and 1:</p>
<ul>
<li><p><strong>0</strong> means the event will <strong>never happen</strong> (impossible event).</p></li>
<li><p><strong>1</strong> means the event is <strong>certain</strong> to happen.</p></li>
</ul>
<p>For example, if you flip a fair coin, the probability of getting heads is <span class="math inline">\(P(Heads)=0.5\)</span> (or 50%).</p>
<p>Probability is a way of quantifying how likely an event is to happen. It’s usually expressed as a number between 0 and 1, where:</p>
<p>0 means the event is impossible (it will never happen). 1 means the event is certain (it will definitely happen).</p>
<section id="why-its-important" class="level4">
<h4 class="anchored" data-anchor-id="why-its-important">Why It’s Important:</h4>
<p>Probability helps us make informed decisions when dealing with uncertainty. It’s used in a wide range of fields—finance, engineering, medicine, etc.—to predict outcomes and risks.</p>
</section>
</section>
<section id="sample-space-s" class="level3">
<h3 class="anchored" data-anchor-id="sample-space-s">2. <strong>Sample Space (S)</strong>:</h3>
<p>The <strong>sample space</strong> is the set of all possible outcomes of an experiment.</p>
<ul>
<li>Example: When rolling a six-sided die, the sample space is: <span class="math inline">\(S = \{1, 2, 3, 4, 5, 6\}\)</span></li>
</ul>
<p>The sample space is the set of all possible outcomes of a random experiment. Example: If you roll a die, the sample space is {1, 2, 3, 4, 5, 6}.</p>
<section id="why-its-important-1" class="level4">
<h4 class="anchored" data-anchor-id="why-its-important-1">Why It’s Important:</h4>
<p>Understanding the sample space is critical because it defines all possible outcomes and allows us to calculate the probability of specific events happening.</p>
</section>
</section>
<section id="event-e" class="level3">
<h3 class="anchored" data-anchor-id="event-e">3. <strong>Event (E)</strong>:</h3>
<p>An <strong>event</strong> is a specific outcome or a set of outcomes within the sample space. It’s the occurrence we’re interested in.</p>
<ul>
<li>Example: In rolling a die, the event “rolling an even number” can be written as: <span class="math inline">\(E = \{2, 4, 6\}\)</span></li>
</ul>
<p>An event is a subset of the sample space. It represents the outcome or group of outcomes you’re interested in. Example: If you want to know the probability of rolling an even number on a die, the event (E) is {2, 4, 6}.</p>
<section id="why-its-important-2" class="level4">
<h4 class="anchored" data-anchor-id="why-its-important-2">Why It’s Important:</h4>
<p>An event helps us focus on the outcomes we care about. In the above example, we’re interested in even numbers, and the event is formed by the favorable outcomes (2, 4, and 6).</p>
</section>
</section>
<section id="probability-of-an-event" class="level3">
<h3 class="anchored" data-anchor-id="probability-of-an-event">4. <strong>Probability of an Event</strong>:</h3>
<p>To calculate the probability of an event <span class="math inline">\(E\)</span>, use the formula:</p>
<p><span class="math display">\[
P(E) = \frac{\text{Number of favorable outcomes}}{\text{Total number of possible outcomes}}
\]</span></p>
<ul>
<li>Example: If you want to find the probability of rolling an even number on a six-sided die: <span class="math inline">\(P(\text{Even}) = \frac{3}{6} = 0.5\)</span></li>
</ul>
<section id="why-its-important-3" class="level4">
<h4 class="anchored" data-anchor-id="why-its-important-3">Why It’s Important:</h4>
<p>This formula gives you a precise way to quantify how likely a particular event is, which is essential for making predictions or calculating risks.</p>
</section>
</section>
<section id="complementary-events" class="level3">
<h3 class="anchored" data-anchor-id="complementary-events">5. <strong>Complementary Events</strong>:</h3>
<p>The <strong>complement</strong> of an event <span class="math inline">\(E\)</span> is the event that <span class="math inline">\(E\)</span> does <strong>not</strong> happen. The probability of the complement is:</p>
<p><span class="math display">\[
P(\text{Not } E) = 1 - P(E)
\]</span> or</p>
<p><span class="math display">\[
P(A') = 1 - P(A)
\]</span></p>
<ul>
<li>Example: If the probability of rain today is 0.3, the probability that it <strong>won’t rain</strong> is: <span class="math inline">\(P(\text{No Rain}) = 1 - 0.3 = 0.7\)</span></li>
</ul>
<section id="why-its-important-4" class="level4">
<h4 class="anchored" data-anchor-id="why-its-important-4">Why It’s Important:</h4>
<p>Complementary events cover all possible outcomes. If you know the probability of an event happening, you can easily calculate the probability of it not happening.</p>
</section>
</section>
<section id="independent-events" class="level3">
<h3 class="anchored" data-anchor-id="independent-events">6. <strong>Independent Events</strong>:</h3>
<p>Two events are <strong>independent</strong> if the outcome of one event does <strong>not</strong> affect the outcome of the other.</p>
<ul>
<li>Example: If you flip a coin and roll a die, the result of the coin flip (heads or tails) does not affect what number you roll on the die. So, these events are independent.</li>
</ul>
<p>For independent events <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span>, the probability of both happening is:</p>
<p><span class="math display">\[
P(A \cap B) = P(A) \times P(B)
\]</span></p>
<p>or more simply:</p>
<p><span class="math display">\[
P(A \text{ and } B) = P(A) \times P(B)
\]</span></p>
<section id="why-its-important-5" class="level4">
<h4 class="anchored" data-anchor-id="why-its-important-5">Why It’s Important:</h4>
<p>Understanding independence is key in more complex probability problems, where you need to calculate the likelihood of multiple events occurring together.</p>
</section>
</section>
<section id="conditional-probability" class="level3">
<h3 class="anchored" data-anchor-id="conditional-probability">7. <strong>Conditional Probability</strong>:</h3>
<p><strong>Conditional probability</strong> is the probability of an event occurring given that another event has already occurred. It’s written as <span class="math inline">\(P(A|B)\)</span> (read as “the probability of <span class="math inline">\(A\)</span> given <span class="math inline">\(B\)</span>”).</p>
<p>The formula for conditional probability is:</p>
<p><span class="math display">\[
P(A|B) = \frac{P(A \cap B)}{P(B)}, \quad \text{for } P(B) &gt; 0
\]</span></p>
<ul>
<li>Example: If you know that a card drawn from a deck is red, the conditional probability that it’s a heart is:</li>
</ul>
<p><span class="math display">\[
P(\text{Heart}|\text{Red}) = \frac{13}{26} = 0.5
\]</span></p>
<section id="why-its-important-6" class="level4">
<h4 class="anchored" data-anchor-id="why-its-important-6">Why It’s Important:</h4>
<p>Conditional probability is essential for making predictions when new information is known. It’s widely used in fields like medicine (probability of a disease given a symptom) and machine learning (probability of a classification given data).</p>
</section>
</section>
<section id="bayes-theorem" class="level3">
<h3 class="anchored" data-anchor-id="bayes-theorem">8. <strong>Bayes’ theorem</strong>:</h3>
<p>This theorem relates two conditional probabilities and allows us to update our beliefs based on new evidence. It is expressed as:</p>
<p><span class="math display">\[
P(A|B) = \frac{P(B|A) \times P(A)}{P(B)}, \quad \text{for } P(B) &gt; 0
\]</span></p>
<p>where <span class="math inline">\(P(B∣A)\)</span> is the probability of event <span class="math inline">\(B\)</span> given that event <span class="math inline">\(A\)</span> has occurred, <span class="math inline">\(P(A)\)</span> is the prior probability of event <span class="math inline">\(A\)</span>, and <span class="math inline">\(P(B)\)</span> is the total probability of event <span class="math inline">\(B\)</span>.</p>
<section id="why-its-important-7" class="level4">
<h4 class="anchored" data-anchor-id="why-its-important-7">Why It’s Important:</h4>
<p>Bayes’ theorem is specifically used to update the probability of an event based on new evidence or information, effectively allowing for a “reverse” calculation of conditional probabilities.</p>
</section>
</section>
</section>
<section id="why-are-these-concepts-important-in-the-real-world" class="level2">
<h2 class="anchored" data-anchor-id="why-are-these-concepts-important-in-the-real-world">Why Are These Concepts Important in the Real World?</h2>
<ol type="1">
<li><p><strong>Decision Making Under Uncertainty</strong>: Probability helps us assess risks and make informed decisions in uncertain situations, such as weather predictions, insurance, stock market investments, and clinical trials.</p></li>
<li><p><strong>Modeling Random Events</strong>: From gambling to genetics, probability models can help describe the behavior of random systems and predict outcomes.</p></li>
<li><p><strong>Statistical Inference</strong>: Many concepts in inferential statistics (like confidence intervals and hypothesis testing) are built on probability theory, allowing us to draw conclusions about populations from sample data.</p></li>
<li><p><strong>Everyday Life</strong>: Probability plays a role in daily decisions—whether it’s understanding the likelihood of traffic delays, deciding to carry an umbrella, or assessing the risk of missing a flight.</p></li>
</ol>
<p>Understanding the basics of probability provides a foundation for more advanced statistical and mathematical concepts and equips you with the tools to make better predictions in uncertain situations.</p>
</section>
<section id="recommended-books" class="level2">
<h2 class="anchored" data-anchor-id="recommended-books">Recommended books</h2>
<p>A good starting point for learning probability theory is the book “Introduction to Probability” by Joseph K. Blitzstein and Jessica Hwang. It covers fundamental concepts in probability theory with clear explanations and examples.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>